<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SticsOnR • SticsOnR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Introduction to SticsOnR">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">SticsOnR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/archives/Introduction_to_sticRs.html">Introduction to SticsOnR</a>
    </li>
    <li>
      <a href="../../articles/archives/Sensitivity_analyses.html">Sensitivity analyses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/SticsOnR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to SticsOnR</h1>
                        <h4 class="author">Rémi Vezy</h4>
            
            <h4 class="date">2019-11-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/SticsOnR/blob/master/vignettes/archives/Introduction_to_sticRs.Rmd"><code>vignettes/archives/Introduction_to_sticRs.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction_to_sticRs.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://SticsRPacks.github.io/SticsOnR/">SticsOnR</a> package provides tools for <a href="https://www6.paca.inra.fr/stics_eng/">STICS</a> developers and users.<br>
The different steps a <a href="https://www6.paca.inra.fr/stics_eng/">STICS</a> developer (or user) often experience can be summarized as:</p>
<ul>
<li>Reading / Writing parameter values</li>
<li>Adding new parameters to files</li>
<li>Evaluate STICS outputs with different parameter values using observations</li>
<li>Use different formalisms in STICS (or new ones for developers), and then evaluate them using observations</li>
<li>Make a sensitivity analysis</li>
</ul>
<p>The package was developed to make these steps fast, reproducible and easy.</p>
<p>This vignette is meant to introduce the concepts of STICS development and parameterization using the <a href="https://SticsRPacks.github.io/SticsOnR/">SticsOnR</a> package.</p>
<div id="stics-inputs-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#stics-inputs-outputs" class="anchor"></a>STICS Inputs / outputs</h2>
<p>STICS uses a minimum of ten input files that group parameters for soil, plants, site, climate etc… An addition of two other files are needed if <a href="https://www6.paca.inra.fr/stics_eng/">STICS</a> is used to model intercrops: one more for the extra plant and one for its technical parameters. One (sole crop) or two (intercrop) optional observation files can also be added for model assessment.</p>
<p>Among all outputs from STICS, one (or two for intercrops) is particularly useful: <code>mod_s*</code> (<code>mod_sp*</code> and <code>mod_sa*</code> for principal and associated plants respectively for intercrops). This file is the most complete output as it contains all outputs needed at daily time-scale.</p>
<div id="example-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h3>
<p>An example set of these files is provided in the <a href="https://github.com/VEZY/SticsOnR/tree/master/tests/testthat/example_data">SticsOnR repository</a>, and more conveniently in a <a href="https://github.com/VEZY/STICS_dummy">separate repository</a>. These data are only dummy data with randomized (but plausible) input values. This example set is a wheat in self-intercropping, <em>i.e.</em> a simulation of a sole crop of wheat in intercropping mode. This is used to evaluate the intercrop module of STICS, which should yield approximately the same outputs in sole crop and in intercrop mode.<br>
It is important to note that the STICS model computes one plant after another for intercrops. The principal plant is the first one to be computed, and the associated one comes second, making the principal plant dominant in the beginning, and the associated dominated. The principal and associated status remains the same over the simulation, however the dominance status can change any time according to plant height.</p>
<p>The example data folder is made of sixteen different files:</p>
<ul>
<li>
<code>climat.txt</code>: the input climate</li>
<li>
<code>ficini.txt</code>: the initialization file</li>
<li>
<code>ficplt1.txt</code>: the principal plant parameters</li>
<li>
<code>ficplt2.txt</code>: the associated plant parameters</li>
<li>
<code>fictec1.txt</code>: the technical parameters for the principal plant</li>
<li>
<code>fictec2.txt</code>: the technical parameters for the associated plant</li>
<li>
<code>mod_sadummy_simulation.sti</code>: the simulation output for the associated plant</li>
<li>
<code>mod_spdummy_simulation.sti</code>: the simulation output for the principal plant</li>
<li>
<code>new_travail.usm</code>: the simulation control file</li>
<li>
<code>param.sol</code>: the soil parameters</li>
<li>
<code>station.txt</code>: the station (<em>i.e.</em> plot) parameters</li>
<li>
<code>tempopar.sti</code>: further parameters</li>
<li>
<code>tempoparv6.sti</code>: further parameters that will be integrated in the next version</li>
<li>
<code>var.mod</code>: Control which simulated variables are written in the <code>mod_s*</code> files.</li>
<li>
<code>wheat_1.obs</code>: observation data for the principal plant</li>
<li>
<code>wheat_2.obs</code>: observation data for the associated plant</li>
</ul>
<p>To download the data, you can either</p>
<ul>
<li>Clone it using GIT:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">git</span> clone https://github.com/VEZY/STICS_dummy.git</a></code></pre></div>
<ul>
<li><p>Or direct download the <a href="https://github.com/VEZY/STICS_dummy/archive/master.zip">zip file here</a>.</p></li>
<li><p>Or use the <a href="https://github.com/ropensci/git2r">git2r</a> package from R:</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># install.packages("git2r")</span></a>
<a class="sourceLine" id="cb2-2" title="2">target_path=<span class="st"> "path_where_to_download_folder"</span></a>
<a class="sourceLine" id="cb2-3" title="3">git2r<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/git2r/man/clone.html">clone</a></span>(<span class="st">"https://github.com/VEZY/STICS_dummy"</span>, target_path)</a></code></pre></div>
<p>However, it is important to note that this exemple dataset should not be used for model assessment because the observation data were not measured but randomly generated, as were the input parameters.</p>
</div>
<div id="using-your-own-data" class="section level3">
<h3 class="hasAnchor">
<a href="#using-your-own-data" class="anchor"></a>Using your own data</h3>
<p>It is strongly encouraged to use your own data instead of the dummy data set. The <a href="https://SticsRPacks.github.io/SticsOnR/">SticsOnR</a> package uses the above-mentioned files, so if you want to use your own data, you simply have to create a USM using javaSTICS for example, and to make a first run with it to create all files needed. After completion, it is encouraged to copy the folder to a new location before using <a href="https://SticsRPacks.github.io/SticsOnR/">SticsOnR</a>, or to use a version control system such as GIT to avoid overwriting a USM when re-opening javaSTICS.</p>
</div>
</div>
<div id="tip-1-use-projects" class="section level2">
<h2 class="hasAnchor">
<a href="#tip-1-use-projects" class="anchor"></a>Tip 1: Use projects</h2>
<p><em>Tips: People in a hurry can jump to the “All the above in one function” paragraph.</em></p>
<p>It is recommended to the user to use RStudio’s projects, or at least a similar structure. The projects allow to better arrange inputs, outputs, model versions and results, but also to keep different projects independent from each others, and to perform version control.<br>
It is also recommended to split the project into several subfolders such as (see Fig.1):</p>
<ul>
<li>0-Data</li>
<li>1-Code</li>
<li>2-Simulations</li>
<li>3-Results</li>
</ul>
<p>The <code>0-Data</code> folder contain all inputs in separated folders, such as model versions (<em>e.g.</em> <code>0-Data/stics_executable</code>) and input files for STICS (<em>e.g.</em> <code>0-Data/stics_input</code>). The <code>1-Code</code> folder contain all R scripts used in the project, the <code>2-Simulations</code> folder is used to perform STICS simulations, and the <code>3-Results</code> is used to store any results from the project (<em>e.g.</em> plots, sensitivity outputs…).</p>
<div class="figure">
<img src="project_folders.png" alt="Figure 1: Project structure" width="100%"><p class="caption">
Figure 1: Project structure
</p>
</div>
<p>For convenience, the different paths are written only once afterwards:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">path_to_data=<span class="st"> "0-Data/stics_input"</span></a>
<a class="sourceLine" id="cb3-2" title="2">path_to_simulation=<span class="st"> "2-Simulations"</span></a>
<a class="sourceLine" id="cb3-3" title="3">path_to_results=<span class="st"> "3-Results"</span></a>
<a class="sourceLine" id="cb3-4" title="4">stics_executable =<span class="st"> "0-Data/stics_executable/stics.exe"</span></a></code></pre></div>
</div>
<div id="tip-2-always-copy-the-simulation-files" class="section level2">
<h2 class="hasAnchor">
<a href="#tip-2-always-copy-the-simulation-files" class="anchor"></a>Tip 2: Always copy the simulation files</h2>
<p>It is highly recommended to copy the simulation files to another disk location before changing any parameter values. This ensures reproducibility and avoid any overwriting of the original data. To do so, the <code>import_usm</code> helper function can be used to copy input files along the STICS executable to a new folder:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SticsOnR)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">import_usm</span>(<span class="dt">dir.orig =</span> path_to_data, <span class="dt">dir.targ =</span> path_to_simulation, <span class="dt">stics =</span> stics_executable, <span class="dt">usm_name =</span> <span class="st">"Test_simulation"</span>)</a></code></pre></div>
</div>
<div id="model-parameterization" class="section level2">
<h2 class="hasAnchor">
<a href="#model-parameterization" class="anchor"></a>Model parameterization</h2>
<p>There are two useful functions in the SticsOnR package to parameterize STICS inputs: <code>read_param</code> to read and <code>set_param</code> to modify a value of a parameter. both functions are wrapper of more specialized functions such as <code>read_plant</code> or <code>set_plant</code>, which read and set the plant parameters respectively.</p>
<p>For example, to read the sowing density for both plants, the use will use <code>read_param</code> as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">read_param</span>(<span class="dt">dirpath =</span> path_to_simulation, <span class="dt">param =</span> <span class="st">"P_densitesem"</span>)</a></code></pre></div>
<p>Which returns:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">tec.plant1.P_densitesem tec.plant2.P_densitesem</a>
<a class="sourceLine" id="cb6-2" title="2">                  <span class="st">"140"</span>                   <span class="st">"140"</span></a></code></pre></div>
<p>The function returns the parameter values, and its name is constructed as: “file.[plant_index.]Parameter_name”. The plant index is only returned for the plant or the technical files.</p>
<p>To modify the value of a parameter for the principal plant (<em>i.e.</em> plant 1), the user will do as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">set_param</span>(<span class="dt">dirpath =</span> path_to_simulation, <span class="dt">param =</span> <span class="st">"P_densitesem"</span>, <span class="dt">value =</span> <span class="dv">145</span>, <span class="dt">plant =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Or to modify the value for both plants:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">set_param</span>(<span class="dt">dirpath =</span> path_to_simulation, <span class="dt">param =</span> <span class="st">"P_densitesem"</span>, <span class="dt">value =</span> <span class="dv">145</span>, <span class="dt">plant =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>))</a></code></pre></div>
<p><em>Tips: if the <code>set_param</code> function cannot set a parameter value because it found a duplicate parameter name across files, use the specialized function directly (e.g. <code>set_tec</code>). You can detect which file you want to modify using the information returned in the names of the parameters returned by the <code>read_param</code> function.</em></p>
<p>To set the variables needed as STICS output, the user can use two functions: <code>find_STICS_var</code> and <code>set_out_var</code>. The first one is a helper to find the variable names used in STICS from the full list returned by <code>all_out_var</code>, and the second is used to tell STICS which variables we need. For our example, the sowing density will probably modify the plant leaf area, its height, and its dry mass, so we want to output all three variables.</p>
<p>For example, if the user do not know the exact output variable name for the plant leaf area index (LAI) beforehand, he can use <code><a href="https://rdrr.io/pkg/SticsRFiles/man/find_STICS_var.html">find_STICS_var()</a></code> from the sticsRFiles package to find all variables that partially match the function <code>Var</code> argument as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SticsRFiles)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&gt; Learn SticsRFiles at: https://SticsRPacks.github.io/SticsRFiles</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/find_STICS_var.html">find_STICS_var</a></span>(<span class="dt">Var =</span> <span class="st">"LAI"</span>)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt;          variable</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; 4       albedolai</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt; 168        exolai</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt; 243        innlai</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt; 257        lai(n)</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt; 258 lai_mx_av_cut</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt; 259        laimax</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt; 260     laisen(n)</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt; 483         splai</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt; 536       ulai(n)</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;                                                              details</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt; 4                   albedo of the crop including soil and vegetation</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt; 168              reduction factor on leaf growth due to water excess</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; 243 reduction factor on leaf growth due to NNI (nitrogen deficiency)</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; 257                                          leaf area index (table)</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt; 258            LAI before cut (for cut crops , for others = lai(n) )</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; 259                                          maximum leaf area index</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; 260                      leaf area index of senescent leaves (table)</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt; 483                source to sink ratio of assimilates in the leaves</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; 536                                relative development unit for LAI</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt;            unit file type V1 V2</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt; 4            SD   sc real  0  0</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co">#&gt; 168         0-1    p real  0  1</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">#&gt; 243 innmin to 1    p real  0  2</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt; 257      m2.m-2    p real  n  2</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt; 258          SD    p real  0  1</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co">#&gt; 259      m2.m-2    p real  0  2</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co">#&gt; 260      m2.m-2    p real  n  2</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co">#&gt; 483          SD    p real  0  2</span></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt; 536         0-3    p real  n  0</span></a></code></pre></div>
<p>Then the user can see that the LAI is called <code>lai(n)</code> in the model, and several other variables are related to LAI (<em>e.g.</em> <code>laisen(n)</code>, which is the senescent leaf area). The procedure is applied for the dry mass, which is called <code>masec(n)</code>, and the height, called <code>hauteur</code>.</p>
<p>Knowing the variable names, the user can now tell STICS which one are needed as simulation outputs:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/set_param.html">set_out_var</a></span>(<span class="dt">filepath =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path_to_simulation,<span class="st">"var.mod"</span>), <span class="dt">vars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hauteur"</span>,<span class="st">"lai(n)"</span>,<span class="st">'masec(n)'</span>))</a></code></pre></div>
</div>
<div id="run-the-model-and-import-the-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#run-the-model-and-import-the-outputs" class="anchor"></a>Run the model and import the outputs</h2>
<p>STICS is called with the <code>run_stics</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">run_stics</span>(<span class="dt">dirpath=</span> path_to_simulation)</a></code></pre></div>
<p>Then, the outputs are read using the <code>read_output</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">out=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/read_output.html">read_output</a></span>(<span class="dt">dirpath=</span> path_to_simulation)</a></code></pre></div>
</div>
<div id="plot-the-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-outputs" class="anchor"></a>Plot the outputs</h2>
<p>The simulation outputs can be plotted using the <code>plot_output</code> function. This function can be used in different ways depending on the parameters provided for the ellipsis (<em>i.e.</em> <code>...</code>):</p>
<ul>
<li>The directory path of the simulation is provided: the function uses <code>read_output</code> under the hood to return a plot of the simulation outputs, <em>e.g.</em>:</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">plot_output</span>(path_to_simulation)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co"># or plot_output(out) using the output from read_output()</span></a></code></pre></div>
<ul>
<li>The output from <code>read_output</code> is provided: the function returns a plot from this data, <em>e.g.</em>:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">out=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/read_output.html">read_output</a></span>(<span class="dt">dirpath=</span> path_to_simulation)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">plot_output</span>(out)</a></code></pre></div>
<ul>
<li>Several outputs from <code>read_output</code> or several paths are provided: the function returns a plot showing a comparison of all inputs, <em>e.g.</em>:</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">Stics_<span class="dv">1</span>=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/read_output.html">read_output</a></span>(<span class="dt">dirpath=</span> path_to_simulation)</a>
<a class="sourceLine" id="cb15-2" title="2">Stics_<span class="dv">2</span>=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/SticsRFiles/man/read_output.html">read_output</a></span>(<span class="dt">dirpath=</span> path_to_simulation2)</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">plot_output</span>(Stics_<span class="dv">1</span>,Stics_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co"># Or :</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co"># plot_output(path_to_simulation,path_to_simulation2)</span></a></code></pre></div>
<p>The user can also compare the simulation output with observed data if available by setting the <code>obs_name</code> parameter:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">plot_output</span>(path_to_simulation, <span class="dt">obs_name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat_1.obs"</span>,<span class="st">"wheat_2.obs"</span>))</a></code></pre></div>
<p>Note that the function also returns information about the input and output files used in the process.</p>
</div>
<div id="faster-all-the-above-in-one-function" class="section level2">
<h2 class="hasAnchor">
<a href="#faster-all-the-above-in-one-function" class="anchor"></a>Faster: All the above in one function</h2>
<p>The <code>stics_eval</code> function is a wrapper of all the previous functions. It imports the files in a new folder, change the parameter values, run the model, return the outputs (simulation output + ggplot2 object) and print the plot. The function also erase the simulation folder upon completion to save disk space by default (this behaviour is controlled by the <code>Erase parameter</code>). The function is called as follows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">out=</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw">stics_eval</span>(<span class="dt">dir.orig =</span> path_to_data,</a>
<a class="sourceLine" id="cb17-3" title="3">             <span class="dt">dir.targ =</span> path_to_simulation,</a>
<a class="sourceLine" id="cb17-4" title="4">             <span class="dt">stics =</span> stics_executable,</a>
<a class="sourceLine" id="cb17-5" title="5">             <span class="dt">Parameter =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">P_densitesem=</span> <span class="dv">145</span>),<span class="dt">Plant =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb17-6" title="6">             <span class="dt">Out_var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hauteur"</span>,<span class="st">"lai(n)"</span>,<span class="st">'masec(n)'</span>),</a>
<a class="sourceLine" id="cb17-7" title="7">             <span class="dt">obs_name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat_1.obs"</span>,<span class="st">"wheat_2.obs"</span>),</a>
<a class="sourceLine" id="cb17-8" title="8">             <span class="dt">Parallel =</span> T,<span class="dt">Erase =</span> T,<span class="dt">plot_it =</span> T,</a>
<a class="sourceLine" id="cb17-9" title="9">             <span class="dt">Title =</span> <span class="st">"Wheat self-intercrop"</span>)</a></code></pre></div>
<p>The example call above creates a new folder (if not already present) copies the STICS input files from “path_to_data” to “path_to_simulation”, copies the STICS model executable from “stics_executable” to “path_to_simulation”, sets a new value for the <code>P_densitesem</code> parameter to 145 for both plants, parameterizes STICS to return 3 output variables (<code>hauteur</code>, <code>lai(n)</code> and <code>masec(n)</code>), sets <code>wheat_1.obs</code> as the observations to compare the simulation outputs with for plant 1 (<em>i.e.</em> Principal) and <code>wheat_2.obs</code> for plant 2 (<em>i.e.</em> Associated), makes the STICS simulations in parallel, and erases the files and folders that were created for the simulation upon completion, and then prints the plot with this title: “Wheat self-intercrop”.</p>
</div>
<div id="compare-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-simulations" class="anchor"></a>Compare simulations</h2>
<p>The <code>stics_eval</code> function can be used to compare the outputs between different parameter values or STICS executable.</p>
<div id="compare-parameter-values" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-parameter-values" class="anchor"></a>Compare parameter values</h3>
<p>If the user want to see if a new parameter value improve the STICS outputs, he can provide several values to the <code>Parameter</code> parameter of the function as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">eval_parameter=</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">  </span><span class="kw">stics_eval</span>(<span class="dt">dir.orig =</span> path_to_data,</a>
<a class="sourceLine" id="cb18-3" title="3">             <span class="dt">dir.targ =</span> path_to_simulation,</a>
<a class="sourceLine" id="cb18-4" title="4">             <span class="dt">stics =</span> stics_executable,</a>
<a class="sourceLine" id="cb18-5" title="5">             <span class="dt">Parameter =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">P_laicomp=</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>,<span class="fl">0.4</span>)),<span class="dt">Plant =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb18-6" title="6">             <span class="dt">obs_name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat_1.obs"</span>,<span class="st">"wheat_2.obs"</span>),</a>
<a class="sourceLine" id="cb18-7" title="7">             <span class="dt">Out_var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hauteur"</span>,<span class="st">"lai(n)"</span>,<span class="st">'masec(n)'</span>),</a>
<a class="sourceLine" id="cb18-8" title="8">             <span class="dt">Title =</span> <span class="st">"Wheat self-intercrop: Parameter comparison"</span>)</a></code></pre></div>
<p>The function returns a list of two objects : <code>outputs</code> and <code>gg_object</code>. The first one lists the model outputs, and the second one is the automatically generated plot.</p>
<p>The plot returned by the function is accessible as follows:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">eval_parameter<span class="op">$</span>gg_object</a></code></pre></div>
And it returns this figure:
<div class="figure">
<img src="stics_eval_Parameter.png" alt="Figure 2: STICS parameter value evaluation" width="100%"><p class="caption">
Figure 2: STICS parameter value evaluation
</p>
</div>
<p>The figure returned has a plot for each simulated variable along with three legends:</p>
<ol style="list-style-type: decimal">
<li><p>The model version, which plots the model simulation output as lines. The model runs (here one for each parameter value) are differentiated with the line type.</p></li>
<li><p>The observation source, which plots the observations present on the simulation folder as points (source folder is always the same using <code>stics_eval</code>, but not necessarily using <code>plot_output</code>). The sources are differentiated with the point type.</p></li>
<li><p>The plant dominance, which plots the plant dominance at initialization (<em>i.e.</em> Principal or Associated) as colours. This plant dominance is different from the <code>dominant</code> output, which tracks the day-to-day plant dominance. This output only have one value for sole crop simulations.</p></li>
</ol>
<p>The <code>outputs</code> object contains the model outputs for each STICS run, which are named after the parameter that was tested, or the model version that was tested, and stored as a list. For our previous example, <code>eval_parameter$outputs</code> has two objects, one for the simulation with <code>P_laicomp= 0.1</code>, and one for <code>P_laicomp= 0.4</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(eval_parameter<span class="op">$</span>outputs)</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">[<span class="dv">1</span>] <span class="st">"P_laicomp_0.1"</span> <span class="st">"P_laicomp_0.4"</span></a></code></pre></div>
<p>The values are accessible as in any R list, for the outputs of the simulation using <code>P_laicomp= 0.1</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">eval_parameter<span class="op">$</span>outputs<span class="op">$</span>P_laicomp_<span class="fl">0.1</span></a></code></pre></div>
<p>and for the outputs of the simulation using <code>P_laicomp= 0.4</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">eval_parameter<span class="op">$</span>outputs<span class="op">$</span>P_laicomp_<span class="fl">0.4</span></a></code></pre></div>
<p>Each <code>outputs</code> object is a data.frame of the simulated variables asked with the <code>Out_var</code> parameter of <code>stics_eval</code>, along with the plant dominance because both plants simulations outputs are in the same data.frame, the Posixct date, the year, month, day and DOI named after the model output (<em>i.e.</em> ian, mo, jo and jul respectively), and all measured variables found in the observation files. The simulated and measured variables are differentiated using the "_sim" and "_meas" suffixes respectively.</p>
<p>The first nine columns and 4 first rows of the data.frame look like this:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Dominance</th>
<th align="left">Date</th>
<th align="right">ian</th>
<th align="right">mo</th>
<th align="right">jo</th>
<th align="right">jul</th>
<th align="right">hauteur_sim</th>
<th align="right">lai_n_sim</th>
<th align="right">masec_n_sim</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Associated</td>
<td align="left">2018-09-26T00:00:00Z</td>
<td align="right">2018</td>
<td align="right">9</td>
<td align="right">26</td>
<td align="right">269</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Associated</td>
<td align="left">2018-09-27T00:00:00Z</td>
<td align="right">2018</td>
<td align="right">9</td>
<td align="right">27</td>
<td align="right">270</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Associated</td>
<td align="left">2018-09-28T00:00:00Z</td>
<td align="right">2018</td>
<td align="right">9</td>
<td align="right">28</td>
<td align="right">271</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Associated</td>
<td align="left">2018-09-29T00:00:00Z</td>
<td align="right">2018</td>
<td align="right">9</td>
<td align="right">29</td>
<td align="right">272</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="compare-model-versions" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-model-versions" class="anchor"></a>Compare model versions</h3>
<p>If the user wants to compare the outputs between two versions of STICS, he can provide several values to the <code>stics</code> parameter of the function as follows:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">eval_version=</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  </span><span class="kw">stics_eval</span>(<span class="dt">dir.orig =</span> path_to_data,</a>
<a class="sourceLine" id="cb24-3" title="3">             <span class="dt">dir.targ =</span> path_to_simulation,</a>
<a class="sourceLine" id="cb24-4" title="4">             <span class="dt">stics =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">STICS_old=</span> stics_executable,</a>
<a class="sourceLine" id="cb24-5" title="5">                          <span class="dt">STICS_new=</span> <span class="st">"version_2/stics.exe"</span>),</a>
<a class="sourceLine" id="cb24-6" title="6">             <span class="dt">obs_name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat_1.obs"</span>,<span class="st">"wheat_2.obs"</span>),</a>
<a class="sourceLine" id="cb24-7" title="7">             <span class="dt">Out_var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hauteur"</span>,<span class="st">"lai(n)"</span>,<span class="st">'masec(n)'</span>),</a>
<a class="sourceLine" id="cb24-8" title="8">             <span class="dt">Title =</span> <span class="st">"Wheat self-intercrop"</span>)</a></code></pre></div>
<p>The function will return this plot:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">eval_version<span class="op">$</span>gg_object</a></code></pre></div>
<div class="figure">
<img src="stics_eval_version.png" alt="Figure 3: STICS model version evaluation" width="100%"><p class="caption">
Figure 3: STICS model version evaluation
</p>
</div>
<p>It has the same structure as the parameter comparison plot, except that the “Model Version” legend shows the model version instead of the parameter used for simulation.</p>
</div>
</div>
<div id="next-sensitivity-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#next-sensitivity-analyses" class="anchor"></a>Next: sensitivity analyses</h2>
<p>The package also has a function to make sensitivity analyses: <code>sensitive_stics</code>. Its usage is detailed in a <a href="https://SticsRPacks.github.io/SticsOnR/articles/Sensitivity_analyses.html">separate vignette</a> for a clearer description.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#stics-inputs-outputs">STICS Inputs / outputs</a></li>
      <li><a href="#tip-1-use-projects">Tip 1: Use projects</a></li>
      <li><a href="#tip-2-always-copy-the-simulation-files">Tip 2: Always copy the simulation files</a></li>
      <li><a href="#model-parameterization">Model parameterization</a></li>
      <li><a href="#run-the-model-and-import-the-outputs">Run the model and import the outputs</a></li>
      <li><a href="#plot-the-outputs">Plot the outputs</a></li>
      <li><a href="#faster-all-the-above-in-one-function">Faster: All the above in one function</a></li>
      <li><a href="#compare-simulations">Compare simulations</a></li>
      <li><a href="#next-sensitivity-analyses">Next: sensitivity analyses</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Remi Vezy, SticsRPacks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
